# Сервис Аутентификации (auth-service)

[![Go Version](https://img.shields.io/badge/go-1.24+-blue.svg)](https://golang.org)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

Этот сервис является центральным узлом аутентификации в проекте. Он отвечает за регистрацию пользователей, вход в систему и выпуск JWT (access и refresh) токенов. Сервис предоставляет HTTP API для клиентов и gRPC-интерфейс для других бэкенд-сервисов для проверки токенов.

## Архитектура Проекта

Проект состоит из трех основных микросервисов, работающих вместе:

-   **`auth-service` (Этот сервис):** Управляет всеми задачами, связанными с пользователями, включая идентификацию и аутентификацию на основе токенов.
-   **[Сервис Чата](../chat-app/README.ru.md):** Сервис для обмена сообщениями в реальном времени через WebSocket, который использует `auth-service` для аутентификации пользователей.
-   **[Обработчик Медиа](../media-processor/README.ru.md):** Асинхронный сервис для обработки загруженных файлов, который также использует `auth-service` для проверки прав доступа пользователей.

## Основные Возможности

-   **Управление пользователями:** Безопасная регистрация с хешированием пароля и вход в систему по email и паролю.
-   **Аутентификация по токену:** Генерирует JWT access-токены (короткоживущие) и refresh-токены (долгоживущие) после успешного входа.
-   **Обновление токена:** Позволяет клиентам получать новую пару токенов, используя действительный refresh-токен, без необходимости повторного ввода учетных данных.
-   **gRPC для внутренней проверки:** Предоставляет высокопроизводительный gRPC-ендпоинт для других сервисов, чтобы быстро и безопасно проверять access-токены.

## Стек Технологий

-   **Язык:** Go
-   **Фреймворки API:**
    -   [Gin](https://github.com/gin-gonic/gin) для HTTP-сервера.
    -   [gRPC](https://grpc.io/) для высокопроизводительной межсервисной коммуникации.
-   **База данных:** PostgreSQL, с доступом через драйвер [pgx/v5](https://github.com/jackc/pgx).
-   **Аутентификация:** [jwt-go](https://github.com/golang-jwt/jwt) для создания и проверки JSON Web Tokens.
-   **Логирование:** `slog` (стандартная библиотека) для структурированного логирования.
-   **Тестирование:** [testify](https://github.com/stretchr/testify) и [testcontainers-go](https://github.com/testcontainers/testcontainers-go) для интеграционного тестирования.

## API Endpoints

### HTTP API

Все ендпоинты имеют префикс `/auth`.

| Метод  | Ендпоинт    | Описание                                                     |
| :----- | :---------- | :----------------------------------------------------------- |
| `POST` | `/register` | Создает новую учетную запись пользователя.                     |
| `POST` | `/login`    | Аутентифицирует пользователя и возвращает пару токенов.        |
| `POST` | `/refresh`  | Выпускает новую пару токенов, используя действительный refresh-токен. |

### gRPC API

Сервис предоставляет gRPC-сервер для внутреннего использования.

| Сервис        | RPC Метод     | Описание                                        |
| :------------ | :------------ | :------------------------------------------------ |
| `AuthService` | `VerifyToken` | Проверяет access-токен и возвращает ID пользователя. |

## Как Запустить

### Рекомендуемый Способ: Docker Compose

Самый простой и рекомендуемый способ запустить весь проект — использовать Docker Compose. Эта команда запустит этот сервис, его базу данных и все остальные связанные сервисы.

1.  Перейдите в корневой каталог проекта.
2.  Выполните команду:
    ```bash
    docker compose up --build
    ```

### Локальная Разработка (Альтернатива)

Вы можете запустить сервис напрямую на вашей машине для разработки.

1.  **Требования:**
    -   Установленный Go 1.24+.
    -   Запущенный экземпляр PostgreSQL.

2.  **Настройте окружение:**
    Создайте файл `.env` в каталоге `auth-service`:
    ```env
    # Порт для HTTP-сервера
    HTTP_PORT=8001

    # Порт для gRPC-сервера
    GRPC_PORT=50001

    # Строка подключения к вашей базе данных PostgreSQL
    DATABASE_URL=postgres://user:password@localhost:5432/auth_db?sslmode=disable

    # Надежный и уникальный секретный ключ для подписи JWT
    JWT_SECRET=your-super-secret-key
    ```

3.  **Запустите сервис:**
    ```bash
    go run ./cmd/auth/main.go
    ```
